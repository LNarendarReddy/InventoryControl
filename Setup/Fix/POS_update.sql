USE [C:\Windows\NSRetailPOS\NSRETAILPOS.MDF]
GO
:ON ERROR EXIT
GO

/****** Object:  StoredProcedure [dbo].[POS_USP_CU_CREFUND]    Script Date: 11-08-2024 23:47:06 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[POS_USP_CU_CREFUND]  
@dtRefund POS_CREFUNDTYPE READONLY,  
@UserID int  
, @BillID INT
, @CustomerName VARCHAR(100)
, @CustomerPhone VARCHAR(10)
AS  
BEGIN  
  
INSERT INTO POS_CREFUND(BILLDETAILID,REFUNDQUANTITY,  
REFUNDWEIGHTINKGS,REFUNDAMOUNT,CREATEDBY,CREATEDDATE)  
SELECT BILLDETAILID,REFUNDQUANTITY,  
REFUNDWEIGHTINKGS,REFUNDAMOUNT,@UserID,GETDATE() FROM @dtRefund  
WHERE REFUNDQUANTITY > 0  
  

  UPDATE POS_BILL
  SET
	CUSTOMERNAME = @CustomerName
	, CUSTOMERNUMBER = @CustomerPhone
	, UPDATEDBY = @UserID
	, UPDATEDDATE = GETDATE()
  WHERE 
	BILLID = @BillID
	AND (ISNULL(CUSTOMERNAME, '') <> @CustomerName OR ISNULL(CUSTOMERNUMBER, '') <> @CustomerPhone)

END
GO

UPDATE TBLCONFIG SET CONFIGVALUE = '1.6.1' WHERE CONFIGID = 1
GO